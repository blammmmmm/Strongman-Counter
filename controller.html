<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Strongman Controller (No Hotkeys)</title>
<style>
  :root{ --bg:#0f1115; --card:#161a22; --text:#eef1f5; --accent:#ffe07a; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:15px/1.25 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
  .wrap{max-width:760px;margin:22px auto;padding:16px}
  .card{background:var(--card); border:1px solid #2a3140; border-radius:14px; padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.25)}
  h1{font-size:20px;margin:6px 0 14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0}
  input[type="number"], input[type="text"]{
    padding:10px 12px;border-radius:10px;border:1px solid #2c3444;background:#0d1016;color:var(--text)}
  button{
    padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#151515;
    font-weight:800;cursor:pointer}
  .grid{display:grid;grid-template-columns:repeat(5, minmax(0,1fr));gap:8px}
  .muted{opacity:.8}
  code{background:#0d1016;padding:2px 6px;border-radius:6px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Strongman Controller</h1>

    <!-- Room connect -->
    <div class="row">
      Room: <input id="room" type="text" value=""/>
      <button id="connectBtn">Connect</button>
      <span id="status" class="muted">disconnected</span>
    </div>

    <!-- Goal -->
    <div class="row">
      Goal <input id="goal" type="number" value="1000000" inputmode="numeric"/>
      <button id="btnGoal">Update Goal</button>
      <button id="btnReset">Reset</button>
    </div>

    <!-- Current -->
    <div class="row">
      Current <input id="current" type="number" value="0" inputmode="numeric"/>
      <button id="btnSet">Set</button>
    </div>

    <!-- Quick + -->
    <div class="row">
      Quick +
      <div class="grid">
        <button data-inc="10">+10</button>
        <button data-inc="20">+20</button>
        <button data-inc="50">+50</button>
        <button data-inc="100">+100</button>
        <button data-inc="200">+200</button>
      </div>
    </div>

    <!-- Custom +/- -->
    <div class="row">
      Custom ± <input id="custom" type="number" value="0" inputmode="numeric"/>
      <button id="btnCustomAdd">+ Add</button>
      <button id="btnCustomSub">− Subtract</button>
    </div>

    <div class="row muted">
      Overlay URL example: <code>…/index.html?room=strman</code> — Make sure this page uses the same <code>?room=</code>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== No hotkeys at all =====
  // We deliberately DO NOT bind keydown listeners on window/document.
  // Also prevent bubbling from inputs (belt & suspenders).
  const stopKeys = (e)=>{ e.stopPropagation(); };
  ['goal','current','custom','room'].forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener('keydown', stopKeys, {capture:true});
    el.addEventListener('keypress', stopKeys, {capture:true});
    el.addEventListener('keyup', stopKeys, {capture:true});
  });

  // ===== BroadcastChannel wiring =====
  let chan = null;
  const qs = new URLSearchParams(location.search);
  const stored = localStorage.getItem('strongman-room') || '';
  const initialRoom = qs.get('room') || stored || 'strongman';

  const $ = (id)=>document.getElementById(id);
  const roomInput = $('room');
  const status = $('status');
  roomInput.value = initialRoom;

  function connect(){
    const room = roomInput.value.trim() || 'strongman';
    try{ if (chan) chan.close(); }catch(e){}
    chan = new BroadcastChannel('room:'+room);
    status.textContent = 'connected → "'+room+'"';
    localStorage.setItem('strongman-room', room);
  }

  function send(msg){
    if (!chan) connect();
    chan.postMessage(msg);
  }

  function num(id){
    const v = parseInt(($(id).value||'0'), 10);
    return isFinite(v) ? v : 0;
  }

  // ===== Buttons =====
  $('connectBtn').addEventListener('click', connect);
  $('btnGoal').addEventListener('click', ()=> send({type:'goal', value: num('goal')}));
  $('btnReset').addEventListener('click', ()=> send({type:'reset'}));
  $('btnSet').addEventListener('click', ()=> send({type:'set', value: num('current')}));
  $('btnCustomAdd').addEventListener('click', ()=> {
    const v = num('custom'); if (v) send({type:'inc', amount: v});
  });
  $('btnCustomSub').addEventListener('click', ()=> {
    const v = num('custom'); if (v) send({type:'dec', amount: v});
  });

  // Quick add grid (data-inc)
  document.querySelectorAll('button[data-inc]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const amt = parseInt(btn.getAttribute('data-inc'),10);
      send({type:'inc', amount: amt});
    });
  });

  // Auto-connect on load AND when room changes
  connect();
  roomInput.addEventListener('change', connect);

  // Prevent Enter from submitting or accidentally triggering anything
  document.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){ e.preventDefault(); e.stopPropagation(); }
    }, {capture:true});
  });
})();
</script>
</body>
</html>
