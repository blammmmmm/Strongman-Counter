<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Strongman Pill â€” Premium Overlay</title>
<style>
  :root{
    --w: 200px; --h: 900px;

    --fill-top:#ff5a5a; --fill-mid:#ff1e1e; --fill-bot:#a80000;

    --rim-outer:#f2e7c9; --rim-inner:#9e8e6f;

    --gold-a:#f4e3b2; --gold-b:#cdb079; --gold-text:#1a1408;

    --label-bg-a:#f3e4b6; --label-bg-b:#c8b07a; --label-text:#1a160d;
  }

  html,body{height:100%;margin:0;background:transparent;overflow:hidden}
  body{display:flex;align-items:center;justify-content:center;
       font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{position:relative;width:var(--w);height:var(--h);isolation:isolate}

  .plaque-top{
    position:absolute; top:-64px; left:50%; transform:translateX(-50%);
    min-width:calc(var(--w)*0.9); padding:10px 14px; border-radius:10px;
    color:var(--gold-text); font-weight:900; font-size:18px; text-align:center;
    background:
      linear-gradient(180deg,var(--gold-a),var(--gold-b)),
      repeating-linear-gradient(0deg,rgba(255,255,255,.14) 0 2px,rgba(255,255,255,0) 2px 6px);
    border:1px solid rgba(0,0,0,.25);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.75), inset 0 -1px 0 rgba(0,0,0,.25), 0 10px 26px rgba(0,0,0,.35);
  }
  .plaque-top .small{font-size:12px;font-weight:800;opacity:.85}

  .pill{position:absolute; inset:0}
  .shell{
    position:absolute; left:0; right:0; top:0; bottom:0;
    border-radius:calc(var(--w)*0.5);
    background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,0));
    box-shadow:inset 0 10px 30px rgba(0,0,0,.32), inset 0 -18px 36px rgba(0,0,0,.35), 0 20px 40px rgba(0,0,0,.35);
  }
  .rim{position:absolute; inset:0; border-radius:calc(var(--w)*0.5);
       box-shadow:0 0 0 2px var(--rim-outer),0 0 0 4px rgba(158,142,111,.18); pointer-events:none}
  .rim::after{content:""; position:absolute; inset:10px; border-radius:calc(var(--w)*0.5 - 10px);
              box-shadow:inset 0 0 0 1.5px var(--rim-inner); opacity:.6}

  .fill{
    position:absolute; left:10px; right:10px; bottom:10px; height:0%;
    border-radius:calc(var(--w)*0.45);
    background:linear-gradient(to top,var(--fill-bot),var(--fill-mid) 45%,var(--fill-top) 100%);
    transition:height .45s cubic-bezier(.22,.9,.24,1); overflow:hidden;
  }
  .fill::after{
    content:""; position:absolute; left:-100%; top:0; bottom:0; width:60%;
    background:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.18),rgba(255,255,255,0));
    animation:sheen 5.6s linear infinite;
  }
  @keyframes sheen{0%{transform:translateX(0)}100%{transform:translateX(260%)}}

  .glass{pointer-events:none; position:absolute; left:10px; right:10px; top:10px; bottom:10px;
         border-radius:calc(var(--w)*0.45);
         background:
           linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.35) 50%,rgba(255,255,255,0)),
           linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,0) 55%,rgba(0,0,0,.10));
         opacity:.65}
  .vignette{pointer-events:none; position:absolute; left:10px; right:10px; top:10px; bottom:10px;
            border-radius:calc(var(--w)*0.45);
            box-shadow:inset 0 0 40px rgba(0,0,0,.18), inset 0 0 80px rgba(0,0,0,.12)}

  .ruler{position:absolute; inset:20px 6px 20px 6px; pointer-events:none}
  .tick{position:absolute; left:14px; right:14px; height:1px; background:linear-gradient(90deg,rgba(255,255,255,.25),rgba(255,255,255,0))}
  .label{
    position:absolute; left:50%; transform:translate(-50%,50%);
    min-width:92px; padding:6px 8px; border-radius:8px;
    background:linear-gradient(180deg,var(--label-bg-a),var(--label-bg-b));
    color:var(--label-text); font-weight:800; font-size:13px; text-align:center;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.75), 0 2px 0 rgba(0,0,0,.22), 0 10px 18px rgba(0,0,0,.22);
  }
  .label.pop{animation:pop .65s ease-out}
  @keyframes pop{0%{transform:translate(-50%,50%) scale(1)}25%{transform:translate(-50%,50%) scale(1.07)}100%{transform:translate(-50%,50%) scale(1)}}

  canvas#confetti{position:absolute; inset:0; pointer-events:none}
</style>
</head>
<body>
<div class="wrap" id="wrap" aria-hidden="true">

  <div class="plaque-top">
    <div class="small">TOTAL</div>
    <div id="topPlaqueText">0</div>
  </div>

  <div class="pill">
    <div class="shell"></div>
    <div class="fill" id="fill"></div>
    <div class="glass"></div>
    <div class="vignette"></div>
    <div class="rim"></div>
  </div>

  <div class="ruler" id="ruler"></div>

  <canvas id="confetti" width="200" height="900"></canvas>
</div>

<script>
const qs=new URLSearchParams(location.search);
const room=qs.get('room')||'strongman';
const chan=new BroadcastChannel('room:'+room);

let current=0;
let goal=1_000_000;

const wrap=document.getElementById('wrap');
const fill=document.getElementById('fill');
const ruler=document.getElementById('ruler');
const topPlaqueText=document.getElementById('topPlaqueText');

const fmt=n=>(n||0).toLocaleString();
const clamp01=x=>Math.max(0,Math.min(1,x));
function pctToY(p){const top=10,bottom=wrap.clientHeight-10;return top+(bottom-top)*p;}

function buildRuler(){
  ruler.innerHTML='';
  const step=goal/10;
  const values=[...Array.from({length:9},(_,i)=>(i+1)*step),goal]; // 100k..goal
  const ticks=6;
  for(let i=0;i<=ticks;i++){
    const y=pctToY(1-i/ticks);
    const t=document.createElement('div'); t.className='tick'; t.style.top=`${y}px`; ruler.appendChild(t);
  }
  for (const v of values){
    const pct=v/goal;
    if (pct<=0) continue;
    const y=pctToY(1-pct);
    const lab=document.createElement('div'); lab.className='label'; lab.style.top=`${y}px`;
    lab.textContent=fmt(Math.round(v));
    ruler.appendChild(lab);
  }
}

let lastMilestoneIdx=0;
function update(){
  const pct=clamp01(current/goal);
  fill.style.height=(pct*100)+'%';
  topPlaqueText.textContent=fmt(current);
}
function resetMilestones(idx=Math.floor((current/goal)*10)){lastMilestoneIdx=idx;}

function checkMilestones(force=false){
  const idx=Math.floor((current/goal)*10);
  if(force){lastMilestoneIdx=idx;return;}
  if(idx>lastMilestoneIdx){
    lastMilestoneIdx=idx;
    const step=goal/10;
    const targetVal=Math.round(idx*step);
    const labs=[...ruler.querySelectorAll('.label')];
    for(const L of labs){if(L.textContent.replace(/,/g,'')==String(targetVal)){L.classList.remove('pop');void L.offsetWidth;L.classList.add('pop');break;}}
  }
}

const confetti=document.getElementById('confetti');
const ctx=confetti.getContext('2d');
let confettiPieces=[];
function burstConfetti(count=200){
  const W=confetti.width;
  confettiPieces.length=0;
  for(let i=0;i<count;i++){
    confettiPieces.push({x:Math.random()*W,y:20+Math.random()*120,vx:(Math.random()-0.5)*2,vy:(Math.random()*2)+1,s:Math.random()*2+1,a:1,c:`hsl(${Math.random()*360},95%,60%)`});
  }
  requestAnimationFrame(stepConfetti);
}
function stepConfetti(){
  ctx.clearRect(0,0,confetti.width,confetti.height);
  let alive=false;
  for(const p of confettiPieces){
    p.x+=p.vx;p.y+=p.vy;p.vy+=0.02;p.a-=0.004;
    if(p.a>0)alive=true;
    ctx.globalAlpha=Math.max(0,p.a);
    ctx.fillStyle=p.c;ctx.fillRect(p.x,p.y,p.s,p.s*3);
  }
  ctx.globalAlpha=1;if(alive)requestAnimationFrame(stepConfetti);
}

function checkGoal(){ if(current>=goal){ burstConfetti(); } }

function onMsg(e){
  const {type,value,amount}=e.data||{};
  switch(type){
    case 'inc':current+=(amount|0);checkMilestones();update();checkGoal();break;
    case 'dec':current=Math.max(0,current-(amount|0));checkMilestones(true);update();break;
    case 'set':current=Math.max(0,(value|0));checkMilestones(true);update();break;
    case 'goal':goal=Math.max(1,(value|0));buildRuler();resetMilestones();update();break;
    case 'reset':current=0;resetMilestones(0);update();break;
  }
}
chan.onmessage=onMsg;

function resizeCanvas(){
  const r=wrap.getBoundingClientRect();
  confetti.width=Math.max(parseInt(getComputedStyle(wrap).width),200);
  confetti.height=Math.max(parseInt(getComputedStyle(wrap).height),900);
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();
buildRuler();
resetMilestones(0);
update();
</script>
</body>
</html>
