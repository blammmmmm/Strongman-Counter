<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Strongman Overlay â€” Glassy</title>
  <style>
    :root{
      --accent:#c81414;      /* tower body red */
      --accent-2:#ffd84a;    /* milestone tiles yellow */
      --tower-width:130px;
      --tower-height:640px;
    }
    *{box-sizing:border-box}
    html,body{
      padding:0; margin:0;
      background:transparent;   /* REQUIRED for OBS transparency */
      height:100%;
    }
    .wrap{display:flex; align-items:center; justify-content:center; width:100%; height:100%;}
    .tower{
      position:relative;
      width:var(--tower-width);
      height:var(--tower-height);
      border-radius:20px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,0) 40%),
        radial-gradient(120px 50% at 50% 0%, rgba(255,255,255,.25), transparent 70%),
        linear-gradient(90deg, #7a0f14 0%, var(--accent) 35%, #7a0f14 100%);
      box-shadow:
        inset 0 10px 24px rgba(255,255,255,.18),
        inset 0 -10px 26px rgba(0,0,0,.35),
        0 24px 80px rgba(0,0,0,.45);
      border:2px solid rgba(255,255,255,.18);
      outline:1px solid #7a0f14bb;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      overflow:hidden;
    }
    .tower::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:20px;
      pointer-events:none;
      background:linear-gradient(180deg,rgba(255,255,255,.28),rgba(255,255,255,0) 18%,rgba(255,255,255,0) 82%,rgba(255,255,255,.2));
      mix-blend-mode:screen;
    }
    .track{
      position:absolute;
      left:50%; transform:translateX(-50%);
      bottom:18px; top:86px;
      width:18px; border-radius:999px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.25), rgba(255,255,255,0)),
        linear-gradient(180deg, #111418, #1b2330);
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.1),
        inset 0 10px 22px rgba(255,255,255,.12);
    }
    .fill{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:18px; width:18px; height:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,.3), rgba(255,255,255,0)),
        linear-gradient(180deg, #ffe675, #ffc400);
      border-radius:999px;
      box-shadow:
        0 0 20px rgba(255,214,0,.4),
        inset 0 8px 16px rgba(255,255,255,.25);
      transition:height .6s cubic-bezier(.22,1,.36,1);
    }
    .puck{
      position:absolute; left:50%; transform:translateX(-50%);
      width:26px; height:26px; bottom:18px;
      background:radial-gradient(circle at 35% 30%,#fff,#f7f2d6 35%,#f2d77c 60%,#d2a600 100%);
      border-radius:999px;
      box-shadow:0 8px 16px rgba(0,0,0,.55), 0 0 0 2px rgba(255,255,255,.35);
      transition:bottom .6s cubic-bezier(.22,1,.36,1);
    }
    .milestones{
      position:absolute;
      right: calc(var(--tower-width) * -0.8);
      top:4px; bottom:4px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .tile{
      width:170px; min-height:40px;
      display:flex; align-items:center; justify-content:center;
      border-radius:12px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.15) 28%, rgba(0,0,0,.06) 100%),
        linear-gradient(180deg, var(--accent-2), #ffcc1a);
      color:#2b1e00; font-weight:900;
      box-shadow:inset 0 2px 0 rgba(255,255,255,.85), 0 10px 24px rgba(0,0,0,.25);
    }
    .buzzer-wrap{
      position:absolute; top:-30px; left:50%; transform:translateX(-50%);
      width:100px; height:100px; border-radius:999px;
      background:radial-gradient(circle at 50% 30%,#fff 0%,#eef1f6 35%,#c9cfda 65%,#505662 100%);
      box-shadow:0 24px 36px rgba(0,0,0,.35), inset 0 4px 10px rgba(255,255,255,.7);
      display:grid; place-items:center;
    }
    .buzzer-light{
      width:78px; height:78px; border-radius:999px;
      background:radial-gradient(circle at 50% 36%,#fff5f5 0%,#ff6b6b 40%,#b20000 100%);
      box-shadow:inset 0 14px 34px rgba(255,255,255,.5), 0 0 0 5px rgba(255,0,0,.18);
    }
    .buzz-anim .buzzer-light{ animation:buzz 1s ease-out both; }
    @keyframes buzz{
      0%{box-shadow:inset 0 16px 38px rgba(255,255,255,.6),0 0 0 0 rgba(255,214,0,.0);}
      35%{box-shadow:inset 0 16px 38px rgba(255,255,255,.65),0 0 30px 12px rgba(255,214,0,.65);}
      100%{box-shadow:inset 0 16px 38px rgba(255,255,255,.6),0 0 0 0 rgba(255,214,0,.0);}
    }
    .labels{
      position:absolute; left:10px; right:10px; bottom:10px;
      display:flex; justify-content:space-between; font-size:12px; color:#fff9;
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="tower" id="tower">
    <div class="buzzer-wrap" id="buzzer"><div class="buzzer-light"></div></div>
    <div class="track"></div>
    <div class="fill" id="fill"></div>
    <div class="puck" id="puck"></div>
    <div class="milestones" id="milestones"></div>
    <div class="labels"><span>0</span><span id="goalLabel">1,000,000</span></div>
  </div>
</div>

<script>
const params = new URLSearchParams(location.search);
const room = params.get("room") || "default";
const height = parseInt(params.get("height"),10) || 640;
document.documentElement.style.setProperty("--tower-height", height+"px");

const channel = new BroadcastChannel("strongman-room-"+room);
const st = { total:0, goal:1000000, milestones:[100000,250000,500000,750000,1000000] };

const puck = document.getElementById("puck");
const fill = document.getElementById("fill");
const bzr  = document.getElementById("buzzer");
const goalLabel = document.getElementById("goalLabel");
const milestoneBox = document.getElementById("milestones");

function pct(){ return Math.min(100, Math.max(0,(st.total / st.goal)*100)); }
function fmt(n){ return n.toLocaleString(); }

function render(){
  const usable = (height - 100);
  const px = Math.round((pct()/100)*usable);
  fill.style.height = px+"px";
  puck.style.bottom = (18 + px)+"px";
  goalLabel.textContent = fmt(st.goal);
  milestoneBox.innerHTML = "";
  [...st.milestones].sort((a,b)=>b-a).forEach(v=>{
    const t=document.createElement("div");
    t.className="tile";
    t.textContent = fmt(v);
    milestoneBox.appendChild(t);
  });
  bzr.classList.toggle("buzz-anim", st.total >= st.goal);
}

channel.onmessage = e=>{
  const m=e.data;
  if(m.type==="sync"){ Object.assign(st,m.payload); render(); }
  if(m.type==="nudge"){ st.total=Math.max(0,st.total+m.payload); render(); }
  if(m.type==="buzz"){ bzr.classList.add("buzz-anim"); setTimeout(()=>bzr.classList.remove("buzz-anim"),1000); }
};

const saved=localStorage.getItem("strongman-state-"+room);
if(saved){ try{ Object.assign(st,JSON.parse(saved)); }catch(e){} }
render();
channel.postMessage({type:"hello"});
</script>
</body>
</html>
